// test suite for products.store.js
const mockJSON = {"id":"shop/new/all-new","name":"All New","categoryType":"subcat","groups":[{"id":"organic-tassel-stripe-bath-mat-dark-horseradish-b3234","name":"Organic Tassel Stripe Bath Mat - Dark Horseradish","links":{"www":"https://www.westelm.com/products/organic-tassel-stripe-bath-mat-dark-horseradish-b3234/"},"priceRange":{"regular":{"high":60,"low":40},"selling":{"high":48,"low":32},"type":"special"},"thumbnail":{"size":"m","meta":"","alt":"","rel":"thumbnail","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202039/0013/organic-tassel-stripe-bath-mat-dark-horseradish-m.jpg","height":363},"hero":{"size":"m","meta":"","alt":"","rel":"hero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202039/0013/organic-tassel-stripe-bath-mat-dark-horseradish-m.jpg","height":363},"images":[{"size":"m","meta":"","alt":"","rel":"althero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202035/0077/organic-tassel-stripe-bath-mat-m.jpg","height":363},{"size":"m","meta":"","alt":"","rel":"althero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202036/0052/organic-tassel-stripe-bath-mat-m.jpg","height":363},{"size":"m","meta":"","alt":"","rel":"althero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202038/0151/organic-tassel-stripe-bath-mat-stone-white-m.jpg","height":363},{"size":"m","meta":"","alt":"","rel":"althero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202019/0034/west-elm-chelsea-bathroom-refresh-bundle-1-m.jpg","height":363},{"size":"m","meta":"","alt":"","rel":"althero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202039/0013/organic-tassel-stripe-bath-mat-dark-horseradish-1-m.jpg","height":363},{"size":"m","meta":"","alt":"","rel":"althero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202036/0053/organic-tassel-stripe-bath-mat-1-m.jpg","height":363},{"size":"m","meta":"","alt":"","rel":"althero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202035/0076/organic-tassel-stripe-bath-mat-m.jpg","height":363},{"size":"m","meta":"","alt":"","rel":"althero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202026/0006/organic-tassel-stripe-bath-mat-m.jpg","height":363},{"size":"m","meta":"","alt":"","rel":"althero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202026/0006/belgian-flax-linen-shower-curtain-m.jpg","height":363},{"size":"m","meta":"","alt":"","rel":"althero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202014/0951/organic-tassel-stripe-bath-mat-stone-white-m.jpg","height":363},{"size":"m","meta":"","alt":"","rel":"althero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202029/0066/organic-striped-arrow-edge-jacquard-shower-curtain-m.jpg","height":363}],"swatches":[],"messages":[],"flags":[{"bopisSuppress":false,"rank":11,"id":"new_colors"}],"reviews":{"recommendationCount":0,"likelihood":0,"reviewCount":0,"averageRating":0,"id":"organic-tassel-stripe-bath-mat-dark-horseradish-b3234","type":"GROUP_REVIEWS"}},{"id":"organic-tassel-stripe-bath-mat-sea-salt-blue-b3235","name":"Organic Tassel Stripe Bath Mat - Sea Salt Blue","links":{"www":"https://www.westelm.com/products/organic-tassel-stripe-bath-mat-sea-salt-blue-b3235/"},"priceRange":{"regular":{"high":60,"low":40},"selling":{"high":48,"low":32},"type":"special"},"thumbnail":{"size":"m","meta":"","alt":"","rel":"thumbnail","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202039/0013/organic-tassel-stripe-bath-mat-sea-salt-blue-m.jpg","height":363},"hero":{"size":"m","meta":"","alt":"","rel":"hero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202039/0013/organic-tassel-stripe-bath-mat-sea-salt-blue-m.jpg","height":363},"images":[{"size":"m","meta":"","alt":"","rel":"althero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202035/0076/organic-tassel-stripe-bath-mat-m.jpg","height":363},{"size":"m","meta":"","alt":"","rel":"althero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202036/0053/organic-tassel-stripe-bath-mat-2-m.jpg","height":363},{"size":"m","meta":"","alt":"","rel":"althero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202035/0077/organic-tassel-stripe-bath-mat-m.jpg","height":363},{"size":"m","meta":"","alt":"","rel":"althero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202036/0052/organic-tassel-stripe-bath-mat-m.jpg","height":363},{"size":"m","meta":"","alt":"","rel":"althero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202038/0151/organic-tassel-stripe-bath-mat-stone-white-m.jpg","height":363},{"size":"m","meta":"","alt":"","rel":"althero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202019/0034/west-elm-chelsea-bathroom-refresh-bundle-1-m.jpg","height":363},{"size":"m","meta":"","alt":"","rel":"althero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202017/0047/organic-tassel-stripe-bath-mat-m.jpg","height":363},{"size":"m","meta":"","alt":"","rel":"althero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202026/0006/organic-tassel-stripe-bath-mat-m.jpg","height":363},{"size":"m","meta":"","alt":"","rel":"althero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202026/0006/belgian-flax-linen-shower-curtain-m.jpg","height":363},{"size":"m","meta":"","alt":"","rel":"althero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202014/0951/organic-tassel-stripe-bath-mat-stone-white-m.jpg","height":363},{"size":"m","meta":"","alt":"","rel":"althero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202029/0066/organic-striped-arrow-edge-jacquard-shower-curtain-m.jpg","height":363}],"swatches":[],"messages":[],"flags":[{"bopisSuppress":false,"rank":11,"id":"new_colors"}],"reviews":{"recommendationCount":0,"likelihood":0,"reviewCount":0,"averageRating":0,"id":"organic-tassel-stripe-bath-mat-sea-salt-blue-b3235","type":"GROUP_REVIEWS"}},{"id":"nomad-2-1-3-seat-sofa-86-5-h6651","name":"Nomad Sofa (86.5&quot;)","links":{"www":"https://www.westelm.com/products/nomad-2-1-3-seat-sofa-86-5-h6651/"},"price":{"regular":1395,"selling":1395},"thumbnail":{"size":"m","meta":"","alt":"","rel":"thumbnail","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202039/0019/nomad-sofa-865-m.jpg","height":363},"hero":{"size":"m","meta":"","alt":"","rel":"hero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202038/0186/nomad-sofa-865-m.jpg","height":363},"images":[{"size":"m","meta":"","alt":"","rel":"althero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202038/0185/nomad-sofa-865-m.jpg","height":363}],"swatches":[],"messages":[],"flags":[{"bopisSuppress":false,"rank":3,"id":"newcore"}],"reviews":{"recommendationCount":0,"likelihood":0,"reviewCount":0,"averageRating":0,"id":"nomad-2-1-3-seat-sofa-86-5-h6651","type":"GROUP_REVIEWS"}},{"id":"nomad-2-1-4-seat-u-sectional-112-h6670","name":"Nomad Grand U Sectional (112&quot;)","links":{"www":"https://www.westelm.com/products/nomad-2-1-4-seat-u-sectional-112-h6670/"},"price":{"regular":2295,"selling":2295},"thumbnail":{"size":"m","meta":"","alt":"","rel":"thumbnail","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202039/0019/nomad-grand-u-sectional-112-m.jpg","height":363},"hero":{"size":"m","meta":"","alt":"","rel":"hero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202038/0185/nomad-grand-u-sectional-112-m.jpg","height":363},"images":[{"size":"m","meta":"","alt":"","rel":"althero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202038/0186/nomad-grand-u-sectional-112-m.jpg","height":363}],"swatches":[],"messages":[],"flags":[{"bopisSuppress":false,"rank":3,"id":"newcore"}],"reviews":{"recommendationCount":0,"likelihood":0,"reviewCount":0,"averageRating":0,"id":"nomad-2-1-4-seat-u-sectional-112-h6670","type":"GROUP_REVIEWS"}},{"id":"nomad-2-1-3-seat-sofa-with-ottoman-86-5-h6652","name":"Nomad Sofa with Ottoman (86.5&quot;)","links":{"www":"https://www.westelm.com/products/nomad-2-1-3-seat-sofa-with-ottoman-86-5-h6652/"},"price":{"regular":1690,"selling":1690},"thumbnail":{"size":"m","meta":"","alt":"","rel":"thumbnail","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202039/0019/nomad-sofa-with-ottoman-865-m.jpg","height":363},"hero":{"size":"m","meta":"","alt":"","rel":"hero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202038/0185/nomad-sofa-with-ottoman-865-m.jpg","height":363},"images":[{"size":"m","meta":"","alt":"","rel":"althero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202038/0185/nomad-sofa-with-ottoman-865-1-m.jpg","height":363}],"swatches":[],"messages":[],"flags":[{"bopisSuppress":false,"rank":3,"id":"newcore"}],"reviews":{"recommendationCount":0,"likelihood":0,"reviewCount":0,"averageRating":0,"id":"nomad-2-1-3-seat-sofa-with-ottoman-86-5-h6652","type":"GROUP_REVIEWS"}},{"id":"nomad-2-1-leather-4-seat-u-sectional-112-h6669","name":"Nomad Leather Grand U Sectional (112&quot;)","links":{"www":"https://www.westelm.com/products/nomad-2-1-leather-4-seat-u-sectional-112-h6669/"},"price":{"regular":3995,"selling":3995},"thumbnail":{"size":"m","meta":"","alt":"","rel":"thumbnail","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202039/0020/nomad-leather-grand-u-sectional-112-m.jpg","height":363},"hero":{"size":"m","meta":"","alt":"","rel":"hero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202038/0185/nomad-leather-grand-u-sectional-112-1-m.jpg","height":363},"images":[{"size":"m","meta":"","alt":"","rel":"althero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202038/0185/nomad-leather-grand-u-sectional-112-m.jpg","height":363}],"swatches":[],"messages":[],"flags":[{"bopisSuppress":false,"rank":3,"id":"newcore"}],"reviews":{"recommendationCount":0,"likelihood":0,"reviewCount":0,"averageRating":0,"id":"nomad-2-1-leather-4-seat-u-sectional-112-h6669","type":"GROUP_REVIEWS"}},{"id":"nomad-2-1-leather-2-seat-sofa-with-ottoman-61-h6668","name":"Nomad Leather Loveseat with Ottoman (61&quot;)","links":{"www":"https://www.westelm.com/products/nomad-2-1-leather-2-seat-sofa-with-ottoman-61-h6668/"},"price":{"regular":1990,"selling":1990},"thumbnail":{"size":"m","meta":"","alt":"","rel":"thumbnail","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202039/0019/nomad-leather-loveseat-with-ottoman-61-m.jpg","height":363},"hero":{"size":"m","meta":"","alt":"","rel":"hero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202038/0186/nomad-leather-loveseat-with-ottoman-61-m.jpg","height":363},"images":[{"size":"m","meta":"","alt":"","rel":"althero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202038/0185/nomad-leather-loveseat-with-ottoman-61-m.jpg","height":363}],"swatches":[],"messages":[],"flags":[{"bopisSuppress":false,"rank":3,"id":"newcore"}],"reviews":{"recommendationCount":0,"likelihood":0,"reviewCount":0,"averageRating":0,"id":"nomad-2-1-leather-2-seat-sofa-with-ottoman-61-h6668","type":"GROUP_REVIEWS"}},{"id":"nomad-2-1-leather-2-seat-chaise-sectional-61-h6667","name":"Nomad Leather Loveseat Reversible Chaise Sectional (61&quot;)","links":{"www":"https://www.westelm.com/products/nomad-2-1-leather-2-seat-chaise-sectional-61-h6667/"},"price":{"regular":2295,"selling":2295},"thumbnail":{"size":"m","meta":"","alt":"","rel":"thumbnail","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202039/0019/nomad-leather-loveseat-reversible-chaise-sectional-61-m.jpg","height":363},"hero":{"size":"m","meta":"","alt":"","rel":"hero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202038/0186/nomad-leather-loveseat-reversible-chaise-sectional-61-m.jpg","height":363},"images":[{"size":"m","meta":"","alt":"","rel":"althero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202038/0186/nomad-leather-loveseat-reversible-chaise-sectional-61-1-m.jpg","height":363}],"swatches":[],"messages":[],"flags":[{"bopisSuppress":false,"rank":3,"id":"newcore"}],"reviews":{"recommendationCount":0,"likelihood":0,"reviewCount":0,"averageRating":0,"id":"nomad-2-1-leather-2-seat-chaise-sectional-61-h6667","type":"GROUP_REVIEWS"}},{"id":"nomad-2-1-leather-2-seat-sofa-61-h6666","name":"Nomad Leather Loveseat (61&quot;)","links":{"www":"https://www.westelm.com/products/nomad-2-1-leather-2-seat-sofa-61-h6666/"},"price":{"regular":1495,"selling":1495},"thumbnail":{"size":"m","meta":"","alt":"","rel":"thumbnail","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202039/0019/nomad-leather-loveseat-61-m.jpg","height":363},"hero":{"size":"m","meta":"","alt":"","rel":"hero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202038/0185/nomad-leather-loveseat-61-1-m.jpg","height":363},"images":[{"size":"m","meta":"","alt":"","rel":"althero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202038/0185/nomad-leather-loveseat-61-m.jpg","height":363}],"swatches":[],"messages":[],"flags":[{"bopisSuppress":false,"rank":3,"id":"newcore"}],"reviews":{"recommendationCount":0,"likelihood":0,"reviewCount":0,"averageRating":0,"id":"nomad-2-1-leather-2-seat-sofa-61-h6666","type":"GROUP_REVIEWS"}},{"id":"nomad-2-1-leather-4-seat-sofa-with-ottoman-112-h6665","name":"Nomad Leather Grand Sofa with Ottoman (112&quot;)","links":{"www":"https://www.westelm.com/products/nomad-2-1-leather-4-seat-sofa-with-ottoman-112-h6665/"},"price":{"regular":2990,"selling":2990},"thumbnail":{"size":"m","meta":"","alt":"","rel":"thumbnail","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202039/0019/nomad-leather-grand-sofa-with-ottoman-112-m.jpg","height":363},"hero":{"size":"m","meta":"","alt":"","rel":"hero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202038/0185/nomad-leather-grand-sofa-with-ottoman-112-m.jpg","height":363},"images":[{"size":"m","meta":"","alt":"","rel":"althero","width":363,"href":"https://assets.weimgs.com/weimgs/rk/images/wcm/products/202038/0185/nomad-leather-grand-sofa-with-ottoman-112-1-m.jpg","height":363}],"swatches":[],"messages":[],"flags":[{"bopisSuppress":false,"rank":3,"id":"newcore"}],"reviews":{"recommendationCount":0,"likelihood":0,"reviewCount":0,"averageRating":0,"id":"nomad-2-1-leather-4-seat-sofa-with-ottoman-112-h6665","type":"GROUP_REVIEWS"}}],"totalPages":47,"categories":[]};

import WSIProdStore  from './products.store';

test('import WSIProdStore from products.store.js', () => {
  expect(WSIProdStore).toBeDefined();
});

const jsonURL =
  'https://terrymorse.com/private/wsicodechallenge/wsi-products.json';
const prodStore = new WSIProdStore(jsonURL);
test('construct WSIProdStore instance', () => {
  expect(prodStore).toBeDefined();
});

// we have to mock fetch, since it does not exist in node
const unmockedFetch = global.fetch;
global.fetch = () => Promise.resolve({ json: () => mockJSON });

test('WSIProdStore readProducts() returns true',
  async (done) => {
    const result = await prodStore.readProducts();
    expect(result).toBe(true);
    global.fetch = unmockedFetch;
    done();
  });

test('WSIProdStore productIds() returns array of length 10', () => {
  const firstId = "organic-tassel-stripe-bath-mat-dark-horseradish-b3234";
  const ids = prodStore.productIds();
  expect(ids.length).toBe(10);
  expect(ids).toContain(firstId);
});

test('WSIProdStore getProduct() with bogus id returns undefined', () => {
  const product = prodStore.getProduct('bogus-id');
  expect(product).not.toBeDefined();
});

test('WSIProdStore getProduct() with valid id returns product', () => {
  const prodId = 'nomad-2-1-leather-2-seat-sofa-with-ottoman-61-h6668';
  const product = prodStore.getProduct(prodId);
  expect(product).toBeDefined();
  expect(product.id).toEqual(prodId);
  expect(product.name)
    .toEqual("Nomad Leather Loveseat with Ottoman (61&quot;)");
});

test('WSIProdStore getVueProduct() returns correct object', () => {
  const prodId = 'nomad-2-1-leather-2-seat-sofa-with-ottoman-61-h6668';
  const prodVue = prodStore.getVueProduct(prodId);
  expect(typeof prodVue).toEqual('object');
  expect(prodVue.id).toEqual(prodId);
  expect(prodVue.priceRange).not.toBeDefined();
  expect(prodVue.price).toBeDefined();
});

test('WSIProdStore getVueProduct() with bogus id returns undefined', () => {
  const prodVue = prodStore.getVueProduct('bogus-id');
  expect(prodVue).not.toBeDefined();
});



